<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabo Pool - Audit Dashboard</title>
    <style>
        :root {
            --primary: #4a6bff;
            --primary-dark: #3a5aee;
            --primary-light: #7289ff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
            --white: #ffffff;
            --gray: #6c757d;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            margin: 0;
            font-size: 28px;
        }

        .subheading {
            opacity: 0.8;
            margin: 5px 0 0;
            font-weight: normal;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            margin-top: 0;
            color: var(--primary);
            font-size: 20px;
        }

        .card p {
            margin-bottom: 20px;
            color: var(--gray);
            font-size: 14px;
            line-height: 1.6;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            font-weight: 500;
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning);
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .actions {
            margin-top: 15px;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }

        .status.running {
            background-color: #cce5ff;
            color: #004085;
            display: block;
        }

        .report-section {
            margin-top: 30px;
        }

        .report-section h2 {
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .report-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .report-card h3 {
            margin-top: 0;
            color: var(--dark);
        }

        .report-card .date {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 5px;
        }

        .badge-success {
            background-color: var(--success);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning);
            color: #212529;
        }

        .badge-danger {
            background-color: var(--danger);
            color: white;
        }

        .badge-info {
            background-color: var(--info);
            color: white;
        }

        footer {
            margin-top: 50px;
            padding: 20px;
            text-align: center;
            color: var(--gray);
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        /* Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: var(--primary);
            display: inline-block;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Report content formatting */
        .report-content {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .no-reports {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }

        .issues-summary {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .issue-count {
            padding: 10px 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .issue-count.high {
            border-left: 4px solid var(--danger);
        }

        .issue-count.medium {
            border-left: 4px solid var(--warning);
        }

        .issue-count.low {
            border-left: 4px solid var(--info);
        }

        .issue-count.good {
            border-left: 4px solid var(--success);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Sabo Pool - Audit Dashboard</h1>
            <p class="subheading">Phân tích và cải thiện chất lượng mã nguồn</p>
        </div>
    </header>

    <div class="container">
        <div class="dashboard">
            <!-- Component Consolidation -->
            <div class="card">
                <h2>Hợp Nhất Component</h2>
                <p>Phân tích và đề xuất cách hợp nhất các component tương tự để giảm trùng lặp mã nguồn.</p>
                <div class="actions">
                    <button class="btn btn-primary btn-block" id="run-component-analysis">Chạy Phân Tích</button>
                </div>
                <div class="status" id="component-status"></div>
            </div>

            <!-- Dependency Analysis -->
            <div class="card">
                <h2>Phân Tích Dependencies</h2>
                <p>Tìm các dependencies không sử dụng, lỗi thời, hoặc có vấn đề bảo mật.</p>
                <div class="actions">
                    <button class="btn btn-info btn-block" id="run-dependency-analysis">Phân Tích Dependencies</button>
                </div>
                <div class="status" id="dependency-status"></div>
            </div>

            <!-- Performance Analysis -->
            <div class="card">
                <h2>Phân Tích Hiệu Năng</h2>
                <p>Phát hiện các vấn đề có thể ảnh hưởng đến hiệu năng trong các component React.</p>
                <div class="actions">
                    <button class="btn btn-warning btn-block" id="run-performance-analysis">Kiểm Tra Hiệu Năng</button>
                </div>
                <div class="status" id="performance-status"></div>
            </div>

            <!-- Security Analysis -->
            <div class="card">
                <h2>Phân Tích Bảo Mật</h2>
                <p>Tìm các lỗ hổng bảo mật và mẫu code không an toàn trong mã nguồn.</p>
                <div class="actions">
                    <button class="btn btn-danger btn-block" id="run-security-analysis">Kiểm Tra Bảo Mật</button>
                </div>
                <div class="status" id="security-status"></div>
            </div>

            <!-- Test Coverage Analysis -->
            <div class="card">
                <h2>Độ Phủ Test</h2>
                <p>Phân tích độ phủ test và đề xuất cách cải thiện các bài test hiện có.</p>
                <div class="actions">
                    <button class="btn btn-success btn-block" id="run-test-analysis">Phân Tích Test</button>
                </div>
                <div class="status" id="test-status"></div>
            </div>

            <!-- Master Analysis -->
            <div class="card">
                <h2>Phân Tích Toàn Diện</h2>
                <p>Chạy tất cả các loại phân tích và tổng hợp kết quả trong một báo cáo duy nhất.</p>
                <div class="actions">
                    <button class="btn btn-primary btn-block" id="run-master-analysis">Phân Tích Toàn Diện</button>
                </div>
                <div class="status" id="master-status"></div>
            </div>
        </div>

        <div class="report-section">
            <h2>Báo Cáo Phân Tích Gần Đây</h2>

            <div id="reports-container">
                <div class="no-reports">
                    <p>Chưa có báo cáo nào được tạo. Hãy chạy phân tích để tạo báo cáo.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for viewing reports -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">Report Title</h2>
            <p id="modal-date">Date: </p>
            <div id="modal-summary"></div>
            <div id="report-content" class="report-content"></div>
            <div class="actions" style="margin-top: 20px;">
                <button class="btn btn-primary" id="download-report">Tải Báo Cáo (Markdown)</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Sabo Pool - Audit Tools &copy; 2025</p>
    </footer>

    <script>
        // Sample report data (in a real implementation, this would be loaded from the server)
        let reportData = [];
        let currentReportType = null;

        // Set some initial data to show on first load
        window.addEventListener('DOMContentLoaded', (event) => {
            reportData = generateMockReports();
            renderReports();
        });

        // Mock data for demonstration
        function generateMockReports() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            return [
                {
                    id: 'comp1',
                    title: 'Tournament Card Consolidation',
                    type: 'component',
                    date: today.toISOString(),
                    summary: {
                        componentCount: 2,
                        usagesCount: 5,
                        unusedCount: 0
                    },
                    content: `# Tournament Card Consolidation Report\n\nDate: ${today.toISOString()}\n\n## Overview\n\nFound 2 tournament card components that can be replaced with UnifiedTournamentCard.\n\n| Component | Type | Props | Usages | Recommended Variant |\n| --------- | ---- | ----- | ------ | ------------------ |\n| SimpleTournamentCard | Simple | 2 | 3 | simple |\n| DetailedTournamentCard | Interactive | 5 | 2 | detailed |\n\n## Detailed Analysis\n\n### SimpleTournamentCard\n\n- **File:** /src/components/tournament/SimpleTournamentCard.tsx\n- **Type:** Simple\n- **Has Children:** No\n- **Props Count:** 2\n- **Memoized:** No\n- **Recommended Variant:** \`simple\`\n\n### DetailedTournamentCard\n\n- **File:** /src/components/tournament/DetailedTournamentCard.tsx\n- **Type:** Interactive\n- **Has Children:** No\n- **Props Count:** 5\n- **Memoized:** No\n- **Recommended Variant:** \`detailed\`\n\n## Next Steps\n\n1. Start with replacing simple, non-interactive components first\n2. For interactive components, ensure event handlers are properly mapped\n3. Test thoroughly after each replacement\n4. Remove original components after all usages have been migrated`
                },
                {
                    id: 'dep1',
                    title: 'Dependency Analysis',
                    type: 'dependency',
                    date: yesterday.toISOString(),
                    summary: {
                        total: 35,
                        unused: 3,
                        outdated: 5,
                        vulnerabilities: 2
                    },
                    content: `# Dependency Analysis Report\n\nDate: ${yesterday.toISOString()}\n\n## Overview\n\n- Total dependencies: 35\n- Production dependencies: 18\n- Development dependencies: 17\n- Unused dependencies: 3\n- Outdated dependencies: 5\n- Security vulnerabilities: 2\n\n## Unused Dependencies\n\n- \`web-vitals\` - Can be safely removed\n- \`moment\` - Can be safely removed (use date-fns instead which is already in the project)\n- \`framer-motion\` - Can be safely removed\n\n## Outdated Dependencies\n\n| Package | Current | Wanted | Latest |\n| ------- | ------- | ------ | ------ |\n| @mui/material | 5.13.0 | 5.13.0 | 5.15.0 |\n| @mui/icons-material | 5.11.16 | 5.11.16 | 5.15.0 |\n| react-scripts | 5.0.1 | 5.0.1 | 5.0.1 |\n| typescript | 4.9.5 | 4.9.5 | 5.2.2 |\n| firebase | 9.22.0 | 9.22.0 | 10.1.0 |\n\n## Security Vulnerabilities\n\n| Package | Severity | Via |\n| ------- | -------- | --- |\n| react-scripts | high | webpack-dev-middleware |\n| firebase | medium | @firebase/auth |`
                },
                {
                    id: 'perf1',
                    title: 'Performance Analysis',
                    type: 'performance',
                    date: today.toISOString(),
                    summary: {
                        components: 15,
                        issues: 12,
                        componentsWithIssues: 7
                    },
                    content: `# Performance Analysis Report\n\nDate: ${today.toISOString()}\n\n## Overview\n\n- Analyzed 15 components\n- Found 12 potential performance issues\n- 7 components have performance issues\n\n## Bundle Size Issues\n\n### Large dependency: moment\n\n- **Severity:** medium\n- **Recommendation:** Consider using date-fns or dayjs which are much smaller alternatives\n\n### Large dependency: lodash\n\n- **Severity:** medium\n- **Recommendation:** Consider importing only needed parts or replacing with a lighter alternative\n\n## Component Performance Issues\n\n### TournamentList\n\n- **File:** /src/components/tournament/TournamentList.tsx\n- **Lines of Code:** 178\n- **Issues Found:** 3\n\n#### Detected Issues:\n\n- **Large component (178 lines)**\n  - Severity: medium\n  - Recommendation: Consider breaking into smaller components\n- **Missing memoization**\n  - Severity: low\n  - Recommendation: Wrap TournamentList with React.memo() to prevent unnecessary rerenders\n- **5 inline functions created in JSX**\n  - Severity: medium\n  - Recommendation: Use useCallback for event handlers to prevent recreation on each render`
                }
            ];
        }

        // Helper functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function updateStatusMessage(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function clearStatusMessage(elementId) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = '';
            statusElement.className = 'status';
        }

        function simulateScriptRun(type, statusId) {
            return new Promise((resolve) => {
                updateStatusMessage(statusId, 'Đang phân tích...', 'running');
                
                // Simulate script running for 2-3 seconds
                setTimeout(() => {
                    // For demo purposes, we'll just show success messages
                    updateStatusMessage(statusId, 'Phân tích hoàn thành! Báo cáo đã được tạo.', 'success');
                    
                    // Add a new report to the list
                    const newReports = generateMockReports().filter(r => r.type === type);
                    if (newReports.length > 0) {
                        reportData = [...newReports, ...reportData];
                        renderReports();
                    }
                    
                    resolve();
                }, 2000 + Math.random() * 1000);
            });
        }

        function renderReports() {
            const reportsContainer = document.getElementById('reports-container');
            
            if (reportData.length === 0) {
                reportsContainer.innerHTML = `
                    <div class="no-reports">
                        <p>Chưa có báo cáo nào được tạo. Hãy chạy phân tích để tạo báo cáo.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            reportData.forEach(report => {
                let badgeHtml = '';
                let summaryHtml = '';
                
                // Generate badges based on report type
                switch(report.type) {
                    case 'component':
                        badgeHtml = `<span class="badge badge-primary">Components</span>`;
                        summaryHtml = `
                            <div class="issues-summary">
                                <div class="issue-count">Components: ${report.summary.componentCount}</div>
                                <div class="issue-count">Usages: ${report.summary.usagesCount}</div>
                            </div>
                        `;
                        break;
                    case 'dependency':
                        badgeHtml = `<span class="badge badge-info">Dependencies</span>`;
                        summaryHtml = `
                            <div class="issues-summary">
                                <div class="issue-count high">Vulnerabilities: ${report.summary.vulnerabilities}</div>
                                <div class="issue-count medium">Outdated: ${report.summary.outdated}</div>
                                <div class="issue-count low">Unused: ${report.summary.unused}</div>
                                <div class="issue-count">Total: ${report.summary.total}</div>
                            </div>
                        `;
                        break;
                    case 'performance':
                        badgeHtml = `<span class="badge badge-warning">Performance</span>`;
                        summaryHtml = `
                            <div class="issues-summary">
                                <div class="issue-count medium">Issues: ${report.summary.issues}</div>
                                <div class="issue-count">Components: ${report.summary.components}</div>
                            </div>
                        `;
                        break;
                    case 'security':
                        badgeHtml = `<span class="badge badge-danger">Security</span>`;
                        break;
                    case 'test':
                        badgeHtml = `<span class="badge badge-success">Tests</span>`;
                        break;
                    case 'master':
                        badgeHtml = `<span class="badge badge-primary">Comprehensive</span>`;
                        break;
                }
                
                html += `
                    <div class="report-card" data-id="${report.id}">
                        <h3>${report.title} ${badgeHtml}</h3>
                        <div class="date">${formatDate(report.date)}</div>
                        ${summaryHtml}
                        <button class="btn btn-primary" onclick="viewReport('${report.id}')">Xem Báo Cáo</button>
                    </div>
                `;
            });
            
            reportsContainer.innerHTML = html;
        }

        // Initialize the modal functionality
        const modal = document.getElementById('reportModal');
        const closeBtn = document.getElementsByClassName('close')[0];

        // Close modal when clicking the X
        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Function to view a report (will be called from HTML)
        window.viewReport = function(reportId) {
            const report = reportData.find(r => r.id === reportId);
            if (!report) return;
            
            document.getElementById('modal-title').textContent = report.title;
            document.getElementById('modal-date').textContent = `Date: ${formatDate(report.date)}`;
            
            // Generate summary based on report type
            let summaryHtml = '';
            switch(report.type) {
                case 'component':
                    summaryHtml = `
                        <div class="issues-summary">
                            <div class="issue-count">Components analyzed: ${report.summary.componentCount}</div>
                            <div class="issue-count">Total usages to update: ${report.summary.usagesCount}</div>
                        </div>
                    `;
                    break;
                case 'dependency':
                    summaryHtml = `
                        <div class="issues-summary">
                            <div class="issue-count high">Security vulnerabilities: ${report.summary.vulnerabilities}</div>
                            <div class="issue-count medium">Outdated packages: ${report.summary.outdated}</div>
                            <div class="issue-count low">Unused dependencies: ${report.summary.unused}</div>
                            <div class="issue-count">Total dependencies: ${report.summary.total}</div>
                        </div>
                    `;
                    break;
                case 'performance':
                    summaryHtml = `
                        <div class="issues-summary">
                            <div class="issue-count medium">Performance issues found: ${report.summary.issues}</div>
                            <div class="issue-count">Components analyzed: ${report.summary.components}</div>
                            <div class="issue-count">Components with issues: ${report.summary.componentsWithIssues}</div>
                        </div>
                    `;
                    break;
            }
            document.getElementById('modal-summary').innerHTML = summaryHtml;
            
            // Set report content
            document.getElementById('report-content').textContent = report.content;
            
            // Set up download button
            const downloadBtn = document.getElementById('download-report');
            downloadBtn.onclick = function() {
                downloadReport(report);
            };
            
            modal.style.display = 'block';
            currentReportType = report.type;
        };

        // Function to download a report as Markdown
        function downloadReport(report) {
            const blob = new Blob([report.content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${report.title.replace(/\s+/g, '-')}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Attach event listeners to buttons
        document.getElementById('run-component-analysis').addEventListener('click', async function() {
            await simulateScriptRun('component', 'component-status');
        });
        
        document.getElementById('run-dependency-analysis').addEventListener('click', async function() {
            await simulateScriptRun('dependency', 'dependency-status');
        });
        
        document.getElementById('run-performance-analysis').addEventListener('click', async function() {
            await simulateScriptRun('performance', 'performance-status');
        });
        
        document.getElementById('run-security-analysis').addEventListener('click', async function() {
            await simulateScriptRun('security', 'security-status');
        });
        
        document.getElementById('run-test-analysis').addEventListener('click', async function() {
            await simulateScriptRun('test', 'test-status');
        });
        
        document.getElementById('run-master-analysis').addEventListener('click', async function() {
            updateStatusMessage('master-status', 'Đang phân tích toàn diện...', 'running');
            
            // Simulate running all analyses one by one
            await simulateScriptRun('component', 'component-status');
            await simulateScriptRun('dependency', 'dependency-status');
            await simulateScriptRun('performance', 'performance-status');
            await simulateScriptRun('security', 'security-status');
            await simulateScriptRun('test', 'test-status');
            
            // Update master status
            updateStatusMessage('master-status', 'Phân tích toàn diện hoàn thành!', 'success');
        });

        // Initialize with empty reports
        renderReports();
    </script>
</body>
</html>
