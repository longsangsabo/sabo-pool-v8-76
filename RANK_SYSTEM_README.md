# 🏆 HỆ THỐNG PHÂN HẠNG SABO POOL ARENA

> **Tài liệu chính thức về hệ thống phân hạng người chơi SABO Pool Arena**  
> *Cập nhật: Tháng 8, 2025*

---

## 📊 1. HỆ THỐNG PHÂN HẠNG NGƯỜI CHƠI

### 1.1 Cấu T### 6.3 SPA Points System
- **Rank-based multipliers** cho tournament rewards
- **Skill bonus** trong challenge system
- **Verification bonus** cho verified ranks

### 6.4 Combined Reward System

**Tournament Performance Example:**
```
Champion (E+ rank player):
├── ELO Reward: +80 points
├── SPA Reward: 1500+ points (rank-dependent)
├── Prize Money: Variable
└── Achievement Badge: Champion

Runner-up (G rank player):
├── ELO Reward: +40 points  
├── SPA Reward: 1000+ points (rank-dependent)
├── Prize Money: Variable
└── Achievement Badge: Finalist
```

**Cross-System Benefits:**
- **ELO gains** contribute to rank progression
- **SPA points** unlock privileges and rewards
- **Tournament success** accelerates both progressions
- **Rank achievements** provide verification status

### 6.5 Complete ELO Information Table

| Hạng | ELO Range | Skill Level | Clear Rate | Tournament ELO | Next Rank Gap | Key Abilities |
|------|-----------|-------------|------------|----------------|---------------|---------------|
| **K** | 1000-1099 | Tân thủ | 2-4 bi | +5 to +80 | 100 points | Học căn bản, chưa nắm kỹ thuật |
| **K+** | 1100-1199 | Người chơi mới | 2-4 bi (tốt hơn) | +5 to +80 | 100 points | Hiểu luật, kỹ thuật cơ bản |
| **I** | 1200-1299 | Novice | 3-5 bi | +5 to +80 | 100 points | Chưa clear chấm, điều bi hạn chế |
| **I+** | 1300-1399 | Novice+ | 3-5 bi (tiến bộ) | +5 to +80 | 100 points | Nhắm & kê cơ chắc, học điều bi |
| **H** | 1400-1499 | Intermediate | 5-6 bi | +5 to +80 | 100 points | "Rùa" 1 chấm hình thuận |
| **H+** | 1500-1599 | Intermediate+ | 6-8 bi | +5 to +80 | 100 points | Clear 1 chấm hình dễ |
| **G** | 1600-1699 | Advanced | Clear 1 chấm + 3-7 bi | +5 to +80 | 100 points | Điều bi hoàn thiện |
| **G+** | 1700-1799 | Advanced+ | Clear 1 chấm + 3-7 bi | +5 to +80 | 100 points | Phá 2 chấm hình đẹp |
| **F** | 1800-1899 | Expert | 60% clear 1 chấm | +5 to +80 | 100 points | Safety cơ bản chắc |
| **F+** | 1900-1999 | Expert+ | 70% clear 1 chấm | +5 to +80 | 100 points | Điều bi 3 băng, safety hiệu quả |
| **E** | 2000-2099 | Master | 90% clear 1 chấm | +5 to +80 | 100 points | Phá 2 chấm khi thuận |
| **E+** | 2100+ | Elite | 90%+ clear 1 chấm | +5 to +80 | Open-ended | Tiệm cận bán-chuyên |

**📊 ELO System Summary:**
- **Base Range:** 1000-2100+ (12 tiers)
- **Progression Gaps:** Consistent 100 points between ranks
- **Tournament Rewards:** +5 (Top 16) to +80 (Champion)
- **Skill Correlation:** Perfect alignment with ball-potting abilities
- **Clear Milestone:** Rank G (1600+) = reliable 1-ball clearanceHạng (Cao → Thấp)

| Hạng | Năng lực cơ bản | Phiên bản nâng (+) | Ghi chú nổi bật |
|------|-----------------|-------------------|-----------------|
| **E+** | • Clear 1 chấm ≈ > 90%<br>• Phá 2 chấm ở hầu hết tình huống<br>• Điều bi phức tạp & safety chuyên nghiệp | Đã tiệm cận hạng D (cấp bán-chuyên) | VĐV dẫn dắt, thi đấu hạng cao |
| **E** | • Clear 1 chấm rất ổn định<br>• Có thể phá 2 chấm khi hình thuận | | Đọc thế bi, chiến thuật, spin control tốt |
| **F+** | • Clear 1 chấm > 70%<br>• Bắt đầu phá 2 chấm khi bi dàn trải | Tiến sát ngưỡng lên E | Điều bi 3 băng, tạo/tháo safety hiệu quả |
| **F** | • Clear 1 chấm ≈ 60%<br>• Điều bi & safety cơ bản chắc tay | | Thi đấu bán nghiệp dư, hướng dẫn hạng thấp |
| **G+** | • Clear 1 chấm + thêm 3-7 bi<br>• Có thể phá 2 chấm hình đẹp | Chuẩn bị lên F | Kiểm soát lực & góc ổn định |
| **G** | • Clear 1 chấm + 3-7 bi kế tiếp | | Khả năng điều bi bắt đầu hoàn thiện |
| **H+** | • Đi 6-8 bi liên tục<br>• Có thể clear 1 chấm trong hình dễ | Sát ngưỡng lên G | Lỗi đánh ổn định hơn H |
| **H** | • Đi 5-6 bi<br>• Có thể clear 1 chấm "rùa" hình thuận | | Điều bi chưa đều, lỗi còn biến động |
| **I+** | • Đi 4-5 bi<br>• Nhắm & kê cơ ngày càng chắc | Sát ngưỡng lên H | Bắt đầu học điều bi chấm đơn |
| **I** | • Đi 3-5 bi tùy hình<br>• Chưa clear chấm | | Khả năng điều bi hạn chế |
| **K+** | • Đi 3-4 bi khi hình dễ<br>• Hiểu luật, kỹ thuật cơ bản | Chuẩn bị lên I | Người chơi mới đã quen bàn |
| **K** | • Đi 2-4 bi (phần lớn ăn may)<br>• Chưa nắm kỹ thuật | | Tân thủ, đang học căn bản |

---

## 🎯 2. CHI TIẾT TỪNG CẤップ ĐỘ

### 🏅 **Hạng Elite (E+, E)**
**Đặc điểm:** Người chơi cấp cao, tiệm cận chuyên nghiệp
- **Kỹ năng chính:** Clear 1 chấm với tỷ lệ rất cao (E+: >90%, E: ổn định)
- **Khả năng nâng cao:** Phá 2 chấm trong nhiều tình huống
- **Chiến thuật:** Điều bi phức tạp, safety chuyên nghiệp, đọc thế bi xuất sắc
- **Vai trò:** VĐV dẫn dắt, mentor cho hạng thấp

### 🥈 **Hạng Expert (F+, F)**  
**Đặc điểm:** Người chơi có kinh nghiệm, kỹ thuật vững chắc
- **Kỹ năng chính:** Clear 1 chấm với tỷ lệ cao (F+: >70%, F: ≈60%)
- **Khả năng nâng cao:** Bắt đầu phá 2 chấm khi điều kiện thuận lợi
- **Chiến thuật:** Điều bi 3 băng, safety hiệu quả
- **Vai trò:** Thi đấu bán nghiệp dư, hướng dẫn người mới

### 🥉 **Hạng Advanced (G+, G)**
**Đặc điểm:** Người chơi trung cấp khá, đang phát triển
- **Kỹ năng chính:** Clear 1 chấm + 3-7 bi kế tiếp
- **Khả năng nâng cao:** Có thể phá 2 chấm khi hình đẹp (G+)
- **Chiến thuật:** Kiểm soát lực & góc ổn định, điều bi đang hoàn thiện
- **Vai trò:** Người chơi trung kiên, tham gia tournament thường xuyên

### 🎖️ **Hạng Intermediate (H+, H)**
**Đặc điểm:** Người chơi trung cấp, đang ổn định kỹ thuật
- **Kỹ năng chính:** Đi 5-8 bi liên tục tùy hạng
- **Khả năng nâng cao:** Clear 1 chấm trong hình dễ (H+), "rùa" hình thuận (H)
- **Chiến thuật:** Điều bi chưa đều, đang học ổn định
- **Vai trò:** Backbone của community, học hỏi tích cực

### 🏃 **Hạng Beginner (I+, I)**
**Đặc điểm:** Người chơi sơ cấp, đang phát triển cơ bản
- **Kỹ năng chính:** Đi 3-5 bi tùy hình
- **Khả năng nâng cao:** Nhắm & kê cơ ngày càng chắc (I+)
- **Chiến thuật:** Bắt đầu học điều bi chấm đơn (I+), khả năng điều bi hạn chế (I)
- **Vai trò:** Đang học hỏi, cần sự hướng dẫn

### 🌱 **Hạng Rookie (K+, K)**
**Đặc điểm:** Người chơi mới, đang học căn bản
- **Kỹ năng chính:** Đi 2-4 bi
- **Khả năng nâng cao:** Hiểu luật & kỹ thuật cơ bản (K+)
- **Chiến thuật:** Đang học căn bản, chưa nắm kỹ thuật (K)
- **Vai trò:** Tân thủ, cần sự kiên nhẫn và hướng dẫn

---

## 📊 3. KHẢNG NĂNG ĐI BI THEO HẠNG

### 3.1 Nhóm Sơ cấp (Beginner)
- **Hạng K:** 2-4 bi khi hình dễ
- **Hạng K+:** 2-4 bi khi hình dễ (có kỹ thuật tốt hơn)

### 3.2 Nhóm Mới học (Novice)
- **Hạng I:** 3-5 bi
- **Hạng I+:** 3-5 bi (có tiến bộ rõ rệt)

### 3.3 Nhóm Trung bình (Intermediate)
- **Hạng H:** 5-8 bi + có thể "rùa" 1 chấm hình dễ
- **Hạng H+:** 5-8 bi (chuẩn bị lên hạng cao hơn)

### 3.4 Nhóm Khá (Advanced)
- **Hạng G:** Clear 1 chấm + 3-7 bi kế tiếp
- **Hạng G+:** Clear 1 chấm + 3-7 bi kế tiếp (trình độ "ngon")

### 3.5 Nhóm Giỏi (Expert)
- **Hạng F:** 60-80% clear 1 chấm, đôi khi phá được 2 chấm
- **Hạng F+:** 60-80% clear 1 chấm (cao nhất nhóm trung cấp)

### 3.6 Nhóm Chuyên nghiệp (Master)
- **Hạng E:** 90-100% clear 1 chấm, 70% phá được 2 chấm
- **Hạng E+:** 90-100% clear 1 chấm, 70% phá 2 chấm (sát ngưỡng D)

---

## 🎯 4. PHÂN TÍCH CHI TIẾT

### 4.1 Progression Path (Lộ trình thăng hạng)

| Chuyển hạng | Từ | Đến | Cải thiện chính |
|-------------|----|----|-----------------|
| **K → K+** | Mới tập | Biết luật, kê cơ đúng | Hiểu cơ bản |
| **I → I+** | Chưa điều chấm | Tân binh tiến bộ | Kỹ thuật ổn định |
| **H → H+** | Hiểu position | Kỹ thuật ổn định | Consistency |
| **G → G+** | Bắt đầu 3 băng | Điều bi 3 băng khá | Ball control |
| **F → F+** | Safety khá chắc | Safety chắc | Tactical mastery |
| **E → E+** | Rất cao | Hoàn thiện | Near-professional |

### 4.2 Key Milestones (Cột mốc quan trọng)

🎯 **5 bi:** Ngưỡng chuyển từ novice sang intermediate (H)
🎯 **Clear 1 chấm:** Ngưỡng chuyển sang advanced (G)  
🎯 **60% clear 1 chấm:** Ngưỡng expert (F)
🎯 **90% clear 1 chấm:** Ngưỡng master (E)

### 4.3 Progression Philosophy

> *"Hệ thống này phản ánh rõ sự tiến bộ từ việc đi được ít bi đến việc clear chấm và phá nhiều chấm, thể hiện trình độ billiard ngày càng cao."*

**Đặc điểm tiến bộ:**
- **Quantity → Quality:** Từ đi nhiều bi → clear chấm chính xác
- **Consistency:** Từ may mắn → ổn định
- **Strategy:** Từ bản năng → chiến thuật
- **Mastery:** Từ cơ bản → chuyên nghiệp

---

## ⚡ 5. TIÊU CHÍ THĂNG HẠNG

### 5.1 Yếu Tố Đánh Giá Chính
1. **Khả năng Clear Chấm**
   - Tỷ lệ thành công clear 1 chấm
   - Khả năng phá 2 chấm trong tình huống khó

2. **Kỹ Thuật Điều Bi**
   - Kiểm soát bi chủ
   - Tạo góc cho cú tiếp theo
   - Safety play

3. **Tính Ổn Định**
   - Độ nhất quán trong performance
   - Khả năng duy trì level trong pressure

4. **Hiểu Biết Chiến Thuật**
   - Đọc thế bàn
   - Ra quyết định đúng đắn
   - Quản lý game

### 5.2 Quy Trình Thăng Hạng
- **Performance Review:** Đánh giá qua nhiều trận đấu
- **Skill Assessment:** Test các kỹ năng cụ thể
- **Peer Evaluation:** Đánh giá từ người chơi cùng level
- **Tournament Results:** Kết quả thi đấu chính thức

---

## 🎮 6. INTEGRATION VỚI HỆ THỐNG GAME

### 6.1 ELO Rating Correlation

| Hạng | ELO Range | Mô tả | ELO Difference |
|------|-----------|-------|----------------|
| K    | 1000-1099 | Rookie tier | Base level |
| K+   | 1100-1199 | Rookie+ tier | +100 |
| I    | 1200-1299 | Novice tier | +100 |
| I+   | 1300-1399 | Novice+ tier | +100 |
| H    | 1400-1499 | Beginner tier | +100 |
| H+   | 1500-1599 | Beginner+ tier | +100 |
| G    | 1600-1699 | Intermediate tier | +100 |
| G+   | 1700-1799 | Intermediate+ tier | +100 |
| F    | 1800-1899 | Advanced tier | +100 |
| F+   | 1900-1999 | Advanced+ tier | +100 |
| E    | 2000-2099 | Expert tier | +100 |
| E+   | 2100+     | Elite tier | Open-ended |

**📊 ELO System Characteristics:**
- **Consistent 100-point gaps** between adjacent ranks
- **Balanced progression** from rookie to elite
- **Open-ended top tier** (E+) for exceptional players
- **Clear milestone markers** every 100 ELO points

### 6.2 Tournament ELO Rewards

| Position | ELO Reward | Percentage of Champion |
|----------|------------|------------------------|
| 🥇 **Champion** | +80 ELO | 100% |
| 🥈 **Runner-up** | +40 ELO | 50% |
| 🥉 **3rd Place** | +20 ELO | 25% |
| 🏅 **4th Place** | +15 ELO | 18.75% |
| 🎖️ **Top 8** | +10 ELO | 12.5% |
| 🏆 **Top 16** | +5 ELO | 6.25% |

**⚡ Tournament ELO System:**
- **Merit-based rewards** theo final position
- **Exponential scaling** - Champion gets 16x more than Top 16
- **Participation incentive** - All top performers get points
- **Rank progression support** - Consistent với 100-point gaps

### 6.3 SPA Points System
- **Rank-based multipliers** cho tournament rewards
- **Skill bonus** trong challenge system
- **Verification bonus** cho verified ranks

---

## 🏆 7. TOURNAMENT STRUCTURE

### 7.1 Phân Chia Giải Đấu
- **Elite Championship (E+, E):** Giải đấu cao nhất
- **Expert Series (F+, F):** Giải bán chuyên
- **Advanced League (G+, G):** Giải trung cấp
- **Intermediate Cup (H+, H):** Giải học viên
- **Rookie Tournament (I+, I, K+, K):** Giải người mới

### 7.2 Cross-Rank Matches
- **Handicap System:** Điều chỉnh race-to cho fair play
- **Upset Bonuses:** Thưởng khi thắng người cao hạng hơn
- **Learning Opportunities:** Cơ hội học hỏi từ cao thủ

---

## 📈 8. PROGRESSION PATH

```
K → K+ → I → I+ → H → H+ → G → G+ → F → F+ → E → E+
 ↑                                                    ↑
Tân thủ                                      Cận chuyên
```

### 8.1 Milestone Rewards
- **Rank Achievement Badges**
- **SPA Point Bonuses**
- **Tournament Entry Privileges**
- **Mentorship Opportunities**

---

## 🎯 9. BEST PRACTICES

### 9.1 Cho Người Chơi
- **Tập trung vào consistency** hơn là flashy shots
- **Học safety play** từ sớm
- **Practice với người cao hạng** để improve nhanh
- **Record và review** các trận đấu quan trọng

### 9.2 Cho Tournament Organizers
- **Fair bracketing** theo rank groups
- **Clear promotion criteria**
- **Regular rank reviews**
- **Mentorship programs**

---

## 📞 10. SUPPORT & UPDATES

- **Technical Issues:** Admin panel → Support
- **Rank Appeals:** Tournament committee review
- **System Updates:** Follow official announcements
- **Community Guidelines:** Fair play và sportsmanship

---

*Tài liệu này được cập nhật thường xuyên để phản ánh chính xác hệ thống ranking của SABO Pool Arena. Mọi thắc mắc xin liên hệ ban quản trị.*

**Version:** 1.1  
**Last Updated:** August 4, 2025  
**Maintained by:** SABO Pool Arena Development Team

---

## 📋 11. HỆ THỐNG ĐĂNG KÝ RANK VỚI XÁC MINH CLB

### 11.1 Tổng quan

Hệ thống này cho phép người dùng đăng ký rank với CLB và CLB có thể phê duyệt, từ chối hoặc yêu cầu kiểm tra tại chỗ. Hệ thống bao gồm các tính năng chống gian lận và thông báo tự động.

### 11.2 Các thành phần chính

#### Database Schema

##### Bảng `rank_requests`
```sql
CREATE TABLE rank_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  requested_rank INTEGER NOT NULL CHECK (requested_rank >= 0 AND requested_rank <= 3000),
  club_id UUID REFERENCES clubs(id) ON DELETE CASCADE,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'on_site_test', 'rejected', 'banned')),
  rejection_reason TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  approved_by UUID REFERENCES auth.users(id),
  approved_at TIMESTAMP WITH TIME ZONE
);
```

##### RLS Policies
- Người dùng chỉ có thể xem yêu cầu rank của mình
- CLB chỉ có thể xem yêu cầu rank của CLB mình
- Chỉ chủ CLB mới có thể phê duyệt/từ chối yêu cầu

#### Components

##### `RankRegistrationForm`
- Form đăng ký rank cho người dùng
- Hiển thị rank hiện tại và lịch sử yêu cầu
- Tích hợp với Google Maps Places Autocomplete

##### `RankRequestsTab`
- Dashboard cho CLB để quản lý yêu cầu rank
- Thống kê theo trạng thái
- Các action: Phê duyệt, Kiểm tra tại chỗ, Từ chối

##### `ClubDashboard`
- Tích hợp ClubProfileTab và RankRequestsTab
- Hiển thị theo vai trò người dùng

#### Hooks

##### `useRankRequests`
- Quản lý CRUD operations cho rank requests
- Gửi notifications tự động
- Tính toán thống kê

### 4. Edge Functions

#### `rank-request-notification`
- Gửi email notifications
- Tạo in-app notifications
- Hỗ trợ SendGrid

## Cài đặt và Triển khai

### 1. Database Migration

Chạy migration để tạo bảng và policies:
```bash
supabase db push
```

### 2. Environment Variables

Thêm vào file `.env`:
```env
VITE_GOOGLE_PLACES_KEY=your_google_places_api_key
SENDGRID_API_KEY=your_sendgrid_api_key
```

### 3. Deploy Edge Functions

```bash
supabase functions deploy rank-request-notification
```

### 4. Cập nhật RLS Policies

Đảm bảo các policies được áp dụng:
```sql
-- Kiểm tra policies
SELECT * FROM pg_policies WHERE tablename = 'rank_requests';
```

## Luồng hoạt động

### 1. Người dùng đăng ký rank
1. Chọn CLB từ danh sách đã xác minh
2. Chọn rank muốn đăng ký (500-3000 ELO)
3. Hệ thống tạo rank request với status 'pending'
4. Gửi notification cho chủ CLB

### 2. CLB xử lý yêu cầu
1. Xem danh sách yêu cầu rank trong dashboard
2. Chọn action:
   - **Phê duyệt**: Cập nhật ELO người dùng, gửi thông báo
   - **Kiểm tra tại chỗ**: Yêu cầu người dùng đến CLB kiểm tra
   - **Từ chối**: Từ chối với lý do (tùy chọn)

### 3. Chống gian lận
- Nếu phát hiện gian lận, admin có thể đánh dấu status 'banned'
- Tự động cấm tài khoản người dùng (is_banned = true)
- Gửi thông báo cấm

## Tính năng bảo mật

### 1. Row Level Security (RLS)
- Người dùng chỉ thấy yêu cầu của mình
- CLB chỉ thấy yêu cầu của CLB mình
- Chỉ chủ CLB mới có quyền phê duyệt

### 2. Validation
- Rank phải trong khoảng 0-3000
- Status phải là một trong các giá trị cho phép
- User phải tồn tại và được xác minh

### 3. Audit Trail
- Lưu thông tin người phê duyệt
- Timestamp cho mọi thay đổi
- Lý do từ chối (nếu có)

## API Endpoints

### Rank Requests
- `GET /rank_requests` - Lấy danh sách (có filter)
- `POST /rank_requests` - Tạo yêu cầu mới
- `PUT /rank_requests/:id` - Cập nhật trạng thái

### Notifications
- `POST /functions/v1/rank-request-notification` - Gửi thông báo

## Monitoring và Logs

### 1. Database Logs
```sql
-- Xem rank requests theo trạng thái
SELECT status, COUNT(*) FROM rank_requests GROUP BY status;

-- Xem rank requests theo CLB
SELECT c.name, COUNT(*) 
FROM rank_requests rr 
JOIN clubs c ON rr.club_id = c.id 
GROUP BY c.name;
```

### 2. Edge Function Logs
```bash
supabase functions logs rank-request-notification
```

## Troubleshooting

### 1. Lỗi thường gặp

#### RLS Policy không hoạt động
```sql
-- Kiểm tra policies
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE tablename = 'rank_requests';
```

#### Edge Function không gửi email
- Kiểm tra SENDGRID_API_KEY
- Kiểm tra logs của function
- Đảm bảo email template đúng format

#### Google Maps không hoạt động
- Kiểm tra VITE_GOOGLE_PLACES_KEY
- Đảm bảo API key có quyền Places API
- Kiểm tra billing của Google Cloud

### 2. Performance

#### Indexes
```sql
-- Tạo indexes cho performance
CREATE INDEX idx_rank_requests_user_id ON rank_requests(user_id);
CREATE INDEX idx_rank_requests_club_id ON rank_requests(club_id);
CREATE INDEX idx_rank_requests_status ON rank_requests(status);
```

#### Pagination
- Sử dụng cursor-based pagination cho danh sách lớn
- Limit kết quả trả về

## Roadmap

### Phase 2
- [ ] Tích hợp với hệ thống matchmaking
- [ ] Auto-ranking dựa trên kết quả thi đấu
- [ ] Tournament ranking system
- [ ] Advanced analytics dashboard

### Phase 3
- [ ] Machine learning để phát hiện gian lận
- [ ] Video verification system
- [ ] International ranking system
- [ ] Mobile app integration

## Support

Nếu gặp vấn đề, vui lòng:
1. Kiểm tra logs trong Supabase Dashboard
2. Xem documentation của Supabase
3. Tạo issue trên GitHub repository 